#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8

RED=$(tput setaf 1)
GREEN=$(tput setaf 2)
YELLOW=$(tput setaf 3)
RESET=$(tput sgr0)

echo "ğŸš€ Preparing to push changes..."
echo "----------------------------------"

echo "ğŸ§ª Running unit tests..."
dotnet test --no-restore --logger "console;verbosity=normal"
TEST_RESULT=$?

echo "----------------------------------"
if [ $TEST_RESULT -eq 0 ]; then
    echo "${GREEN}âœ… Tests Completed Successfully!${RESET}"
    echo "${YELLOW}ğŸ“Š Test Summary from last run:${RESET}"
    dotnet test --no-build --no-restore --logger "console;verbosity=minimal"
    echo "----------------------------------"
    echo "ğŸš€ Ready to push!"
else
    echo "${RED}âŒ Some tests failed!${RESET}"
    echo "${YELLOW}ğŸ“Š Test Summary from last run:${RESET}"
    dotnet test --no-build --no-restore --logger "console;verbosity=detailed"
    echo "----------------------------------"
    echo "${RED}âŒ Push blocked due to test failures${RESET}"
    exit 1
fi

#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

export LC_ALL=en_US.UTF-8
export LANG=pt_BR.UTF-8
RED=$(tput setaf 1)
GREEN=$(tput setaf 2)
RESET=$(tput sgr0)

echo "üöÄ Preparing to commit changes..."
echo "----------------------------------"

echo "üé® Checking C# file formatting with CSharpier..."
if dotnet csharpier . --check; then
    echo "${GREEN}‚úÖ All files are properly formatted.${RESET}"
else
    echo "${RED}‚ùå Some files need formatting. Formatting now...${RESET}"
    dotnet csharpier .
    echo "${GREEN}‚úÖ Files formatted successfully. Adding to commit...${RESET}"
    git add .
fi

echo "üõ†Ô∏è Verifying code style with 'dotnet format style --severity info'..."
if dotnet format style --severity info --verify-no-changes; then
    echo "${GREEN}‚úÖ Code style verification passed.${RESET}"
else
    echo "${RED}‚ùå Code style issues found. Formatting now...${RESET}"
    dotnet format style --severity info
    echo "${GREEN}‚úÖ Code style issues fixed. Adding to commit...${RESET}"
    git add .
fi

echo "üîç Running analyzers with 'dotnet format analyzers --severity info'..."
if dotnet format analyzers --severity info --verify-no-changes; then
    echo "${GREEN}‚úÖ Analyzer checks passed.${RESET}"
else
    echo "${RED}‚ùå Analyzer issues found. Fixing now...${RESET}"
    dotnet format analyzers --severity info
    echo "${GREEN}‚úÖ Analyzer issues fixed. Adding to commit...${RESET}"
    git add .
fi

echo "----------------------------------"
echo "${GREEN}‚úÖ Pre-commit checks completed successfully.${RESET}"

#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸš€ Preparing to push changes..."

echo "ğŸ§ª Running unit tests..."
if dotnet test --filter "Category=Unit" --logger "console;verbosity=detailed"; then
    echo "âœ… All unit tests passed successfully!"
else
    echo "âŒ Some tests failed. Please fix them before pushing."
    exit 1
fi

echo "ğŸ¨ Checking C# file formatting with CSharpier..."
if dotnet csharpier . --check; then
    echo "âœ… All files are properly formatted."
else
    echo "âŒ Some files need formatting. Formatting now..."
    dotnet csharpier .
    echo "âœ… Files formatted successfully. Adding to commit..."
    git add .
fi

echo "ğŸ› ï¸ Running format check on staged files..."
dotnet husky run --name dotnet-format-csharpier

echo "ğŸš€ Ready to commit changes!"
echo "âœ… Pre-commit checks completed successfully."
